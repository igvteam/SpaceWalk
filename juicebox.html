<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>Juicebox</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <script src="vendor/touchpolyfill.min.js"></script>

    <!-- font awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">

    <!-- Juicebox CSS-->
    <link rel="stylesheet" type="text/css" href="vendor/juicebox.css">

    <!-- IGV JS -->
    <script src="https://cdn.jsdelivr.net/npm/igv@2.2.6/dist/igv.min.js"></script>

    <!-- Juicebox JS -->
    <script src="vendor/juicebox_tracing3d.js"></script>
    <script src="vendor/hic-straw.js"></script>

</head>

<body>


<div id="juicebox-container" class="juicebox-app-clone-container"></div>


<script type="text/javascript">

    document.addEventListener("DOMContentLoaded", async () => {

        const urlShortenerConfig =
            [
                {
                    provider: "bitly",
                    apiKey: "ABCD",        // TODO -- replace with your Bitly access token
                    hostname: 'bit.ly'
                },
                {
                    provider: "google",
                    apiKey: "ABCD",        // TODO -- replace with your Google API Key
                    hostname: "goo.gl"
                }
            ];

        hic.setURLShortener(urlShortenerConfig);

        let query = hic.extractQuery(window.location.href);

        if (query && query.hasOwnProperty("juiceboxURL")) {

            let jbURL = await hic.expandURL(query["juiceboxURL"]);
            query = hic.extractQuery(jbURL);

            await createBrowsers(document.getElementById("juicebox-container"), query);
        } else {
            await createBrowsers(document.getElementById("juicebox-container"), query);
        }

    });

    let createBrowsers = async (container, query) => {

        let config;

        config =
            {
                figureMode: true,
                width: 480,
                height: 480
            };

        if (query && query.hasOwnProperty( 'juicebox' )) {

            let q = query[ 'juicebox' ];

            if (q.startsWith("%7B")) {
                q = decodeURIComponent(q);
            }

            q = q.substr(1, q.length - 2);

            let parts = q.split("},{");
            config.href = decodeURIComponent(parts[0]);

            hic.createBrowser(container, config);

            if (parts && parts.length > 1) {

                for (let part of parts) {

                    config = Object.assign({}, config);
                    config.href = decodeURIComponent(part);

                    await hic.createBrowser(container, config, syncBrowsers);
                }

            }

        } else {
            await hic.createBrowser(container, config);
        }
    };

    let syncBrowsers = () => {
        hic.syncBrowsers(hic.allBrowsers);
    };

</script>

</body>

</html>
